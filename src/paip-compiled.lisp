(in-package #:bones.paip)

;;;; Utils
(defun find-all (item sequence
                      &rest keyword-args
                      &key (test #'eql) test-not &allow-other-keys)
  "Find all elements of the sequence that match the item.

  Does not alter the sequence.

  "
  (if test-not
    (apply #'remove
           item sequence :test-not (complement test-not)
           keyword-args)
    (apply #'remove
           item sequence :test (complement test)
           keyword-args)))

(defun interned-symbol (&rest args)
  (intern (format nil "窿狎珞┅ㄤ彐躅铄鳝簌礅镬é蝈篝狎珞磲脲簌礅镬ㄦ矧磲铋窿狎珞┅ㄤ彐躅骈钿殒犷麒弪翦篝屮痱ㄣ镱è骢钽犰翦篝屮痱舂è泔铙屮痱矧ㄦ轭洵殒犷麒弪翦篝ㄣ狎屮痱┅ㄦ轭洵殒犷麒弪翦篝ㄣ潋屮痱┅┅铋飑┅换换瘴善擅猎上换换轴蜷徕戾ㄤ彐轭瀛泔铙翎铘躅怙躅⒄钼秕钿呼弩＇羼踽轰镢蹴孱翎糸镱⒘磲玳泔铙翎铘蝈痱弩孱糸铉犷躅怙躅鲠蜷徕戾ㄤ彐鲠鲠颦泔躅翦颡⒃桢铛礅弪镦鲠蜷徕戾泸遽翦箫驷虍ㄤ彐篝蝓泗鲠ê泔铙趄蹉麸īê痱轭舡骢钽糸镱痱轭舡鲠颟钺礤ㄩ钽鲠颦泔躅翦颡┅澡鲠蜷徕戾钺礤ㄤ彐狨祠麸铄铛礅弪ㄢ轭溟铉躅怙躅洎澡鲠蜷徕戾忾钿轭ㄤ彐狨祠麸躅怙躅洎ㄤ彐躅痱轭舡鲠è鲠鲠颟篝蝈犴溴痿瑭ㄩ矧ㄡ钿铛礅弪痱轭舡戾鲥飒窘溴痿痱轭舡戾鲥飒┅鲠颦ㄤ弪彐鲠颟┅ㄦ矧磲篝蝈犴⒖立鲠颦钺礤鲠颟黩轸鲠后趄遽篝蝈犴┅ㄤ彐躅怙躅洵è鲠鲠颟ê蝈趱蝾怙镬遽瞟⒁弭躜麒弭桢翳玳鲥鲠蜷徕戾栳忮孱怙躅洚铒ㄥ鲠颦忾钿轭鲠颟躅怙躅洎┅ㄤ彐磲泸溴蝈ㄥ痱⒚栳箦犰翳忾钿轭珞骘翳玳鲥屮痱弩箝镱轭痨徙瀹啜痱镧祜镳瑚栝戾ㄡ钿鲠颦屮痱ㄢ秕钿屮痱┅轰箦翩屮痱鲠颦忾钿轭屮痱┅屮痱┅换换麻钿轭珞ㄤ彐鲠趄衢飒磲脲狎蜥舶烘殪飙痫轭翦横潢躞翎忪舂⒃桢趄衢镦鲠蜷徕戾忾钿轭珞疱蜴矧礤箫驷虍ㄤ彐躅箦舡忾钿轭纭è鲠鲠颟鲠祯濠ê蝈趱蝾ㄥ耢舂⒂弭圉狎唰忾钿轭麸圉犰蹂徭翦筢鲩铉轸轭翳趄衢飚领麽蝈趱蝾圄篚沣弩螬麒孱铒ㄥ鲠鲠祯濠鲥泗矧瘐箬屮翦钿鲠趄衢飒箦翩鲠颦忾钿轭鲠颟鲠祯濠舂ㄤ彐躅躅滹忾钿轭珞è镬洵趄衢轭翦珏颟ê蝈趱蝾忽镩洎⒄钿犰忾钿轭珞忉汶麸玳鲥痫轭轭翳趄衢飚澡痫轭轶箴邈殒殄怡玳鲩铉翳溴箝蝈骈祆痫轭翦虍祜镳乎铘殪ㄦ殪飙痫轭翦趄衢飒镬洵趄衢飑轰箦翩鲠颦忾钿轭鲥泗矧痫趄衢飒┅躅怙躅洎鲠祯弩┅换换疹殒殂狒轱ㄤ彐躅躅殒ê蝈趱蝾怙镬遽瞟⒛弩趄蹉糸鲥禊躅殒赭屮痱弩箝镱蟋蝈趱蝾轭麒弭桢轸麽篚沣弩箧蹯令鲠蜷徕戾轭帏犷帙磲栳鲥翳彘忾钿轭珞箦舢ㄣ镱换涉翳妁蝈殇孱糸汜镡赍泗翎腴铉忾钿轭珞轭麸徙泔躅舂翳妁躅殒è羼ㄤ弪彐ㄤ弪彐┅舂换涉翳妁蝈铒殇孱糸汜飕怩镱轶鲠蜷徕戾忾钿轸麸翳雉桢虍è鲠颦箦舡忾钿轭纭┅è鲠颦箦舡忾钿轭纭┅换涉翳妁蝈怙翳铒瞽屙痿扉篝蟋躅殒翳汜蝮犷沅蝮è犷ㄣ镱箴ㄣ镱箴┅ㄡ钿躅殒ㄦ轵篝ㄦ轵篝┅躅殒蝈篝蝈篝┅┅换萧桢蝼轶翳妁滹瞌躅殒铋飑┅换换孟托商猎上ㄤ彐豉疱蝈灬糸镱īъ轶舂ㄤ彐豉疱沆狨箦īЖ趄轹獒飙豉疱蠛痱镳弪扉篝蝈灬糸镱┅ㄤ彐豉疱铒瞽铄玑糸鲥轭翦珏īЖ轭翦珏癌ㄤ彐躅痱镬镧泔眇殪簌礅镬镳糸镱犰ㄣ灬躞弩ㄧ弭沆狨箦簌礅镬┅⒚镯痖戾簌礅镬磲脲箦疳蜥翦骢钽糸镱骘遽汨狎轸麒孱铒铛祆沆狨箦螬戾舄è狎轸蝈灬糸镱狎轸ㄣ灬躞瀛桢徜ㄦ轵篝沆狨箦螬┅磲翥栝铉狎轸沆狨箦ㄣ灬躞弩鏖翳狎轸沆狨箦＇狎轸┅雉桢颦狎轸沆狨箦ㄣ灬躞弩鏖翳狎轸沆狨箦＇狎轸┅ㄣ镯痖戾痱邃殂狒簌礅镬狎轸磲翥栝铉狎轸沆狨箦螬痱镬镧泔眇殪簌礅镬雉桢颦狎轸沆狨箦螬┅ㄤ彐躅沆狨箦蟓鏖翳狎轸è沆狨箦趄轹獒飙豉疱蠛痱镳弪扉篝沆狨箦┅翦篝骢钽糸镱ㄡ蜷豉铒瞽铄玑糸鲥轭翦珏颟⒁弭躜犰沆狨箦麒矬桢徜栳鲥翳玳鲥狎轸ㄦ轭洵犰狎轸沆狨箦弘妁＇灬礅溽ㄣ灬躞濠蝈灬糸镱狎轸ㄣ灬躞瀛桢徜沆狨箦┅呼弩翦篝┅ㄤ彐躅蝈灬糸镱狎轸è蝈灬糸镱蝈灬糸镱┅ê蝈趱蝾铒瞽铄玑糸鲥轭翦珏颟⒁弭躜翳铛礅弪镦狎珲礤铘镦翳玳鲥蝈灬糸镱骑屮犴痨搴啜蝈灬糸镱狎轸Ж扉脲筢祆汜趔┅骄嗖戾铉翳蝈灬糸镱狎珲礤铘蝈灬糸镱┅ㄤ彐躅蝈灬糸镱狎珲礤铘è蝈灬糸镱蝈灬糸镱┅ê蝈趱蝾扉篝⒁弭躜翳狎珲礤铘镦翳玳鲥蝈灬糸镱骑屮犴痨搴蝈灬糸镱狎珲礤铘Ж扉脲筢祆汜趔┅筢祆汜趔蝈篝蝈灬糸镱┅ㄤ彐躅泔眇殪瀛痱邃殂狒è簌礅镬簌礅镬ㄡ蜷豉铒瞽铄玑糸鲥轭翦珏颟ㄣ灬躞弩趄轹獒飙豉疱蠛痱镳弪扉篝沆狨箦┅⒚镯痖戾犰翳沆狨箦骘翳簌礅镬狎轸轭麸箝铉戾涕箴骢钽糸镱戾è痱邃殂狒磲脲痱邃殂狒簌礅镬狎轸┅疳蜥礤翦蝮磲脲疳蜥礤翦蝮狎轸┅ㄣ镯痖戾ㄥ鲠啜溴骢痱邃殂狒ì鲤狎犴弭弪泔铘轭踽糸镱磲忮徜洵躅滹忾钿轭珞磲疸狎＇灬礅溽ㄣ灬躞濠ㄣ镯痖戾沆狨箦疳蜥礤翦蝮沆狨箦с镱糸铛狒轱瞟沆狨箦螬┅┅┅ㄤ彐躅磲脲疳蜥礤翦蝮è狎轸铒瞽铄玑糸鲥轭翦珏颟ê蝈趱蝾趄轹獒飙豉疱蠛痱镳弪扉篝簌礅镬┅⒁弭躜翳扉篝酷蜱酷蜱酷蜱惟祜镳烘矧烘蝻呼狎轸恒镬戾泗铄鳝簌礅镬Э狎椹┅ㄤ彐躅磲脲痱邃殂狒è簌礅镬簌礅镬ㄡ蜷豉铒瞽铄玑糸鲥轭翦珏颟ê蝈趱蝾簌礅镬⒁弭躜铙ㄡ钿轭翦蝾螬翳簌礅镬鏖翳翳序镬镧篝戾钺礤簌礅镬狎轸鲠祯弩ㄩ铘弪铄洵簌礅镬簌礅镬Н狎轸┅ㄤ彐躅磲脲啜┅ㄤ彐躅泔眇殪瀛沆狨箦疳蜥礤翦蝮沆狨箦泔铘轭踽糸镱⒃蜥铙骘蝽狩狴翳桢徜犷泔眇殪翳蝈篚祠轭怙澌ㄢ轭洵躅怙躅洵鲠蝮疳蜥礤翦蝮ㄣ镯痖戾怙澌钽镱磲疸狎＇磲脲疳蜥礤翦蝮蝈灬糸镱狎珲礤铘ㄣ灬躞瀛桢徜沆狨箦┅ㄣ灬躞瀛怙澌沆狨箦┅泔铘轭踽糸镱┅ㄤ彐躅泔眇殪瀛怙澌ㄢ镤泔铘轭踽糸镱⒚镯痖戾翳怙澌镦沆狨箦ㄩ铛祆怙澌啜骢钽犰泔铘轭踽糸镱戾舄è顼犰ㄦ轵篝怙澌┅磲泸痱镬镧泔眇殪弪磲泸痱邃殂狒顼犰┅磲泸锃鲠麒孱磲泸ㄦ躅汜祆磲泸顼犰蝈篝怙澌泔铘轭踽糸镱┅┅ㄩㄡ钿磲泸铒ㄥ磲泸锃鲠吼狍螬┅磲泸锃鲠ㄣ镯痖戾汜祆磲脲痱邃殂狒痱邃殂狒顼犰蝈灬糸镱狎轸顼犰┅磲疸狎＇灬礅溽ㄡ蜱ㄣ镯痖戾狎狎绌蝈灬糸镱狎珲礤铘顼犰┅ㄩ铛祆蝈篝怙澌┅泔铘轭踽糸镱啵Ж灬礅溽īㄣ镯痖戾怙澌蝈篝怙澌泔铘轭踽糸镱┅┅┅┅ㄤ彐躅泔眇殪瀛汜祆痱邃殂狒狎珞泔铘轭踽糸镱啜痱邃殂狒泪蜱泔铘轭踽糸镱┅ㄤ彐躅痱镬镧泔眇殪弪磲泸钺礤⑵弭汨翳泔眇殪弪磲泸骘序镬镧痱邃殂狒瀹ㄧ弭钺礤ю蝻祜绛泔眇殪弪磲泸铹ㄤ彐磲泸溴姝痱镬镧泔眇殪弪磲泸钺礤狎珈轶怙澌怙澌⒛彐轭泔眇殪弪磲泸骘序镬镧啜箦翩ㄧ弭К钺礤ю蝻祜绛泔眇殪弪磲泸铹＇灬礅溽狎珈轶怙澌┅ㄤ彐痱镬镧泔眇殪弪磲泸ㄧ镝怙澌泔铘轭踽糸镱戾è狎珞蝈灬糸镱狎珲礤铘顼犰┅ㄩǒ戾铉翳狎珞博吼狍啜麒孱ㄣ镯痖戾躅殒ㄦ轵篝狎珞箦泔钿狎珞┅ㄣ镯痖戾怙澌怙澌泔铘轭踽糸镱┅┅ㄤ彐躅泔眇殪瀛躅殒⒁弭躜泔溴翳狒翦篝殒翳轸屙躅殒啜躅殒ㄣ镯痖戾狎ㄣ镯痖戾狎┅ㄤ彐躅泔眇殪瀛狎ㄡ蜱⑶孱弪狒泔溴骘犷狎珲礤铘麸顼犰轭翳怙澌ㄣ镱è鲠蜷徕戾狎绌狎绌è铒ㄨ狍鲠蜷徕戾狎绌唰狎绌è痱镳弪扉篝狎绌啜扉篝磲疸狎＇泔眇殪瀛狎狎绌┅啜泔铙ㄣ镯痖戾狎ㄦ轵篝狎绌ㄣ镯痖戾狎蝈篝狎绌┅┅ㄤ彐躅栳蟓鲠蜷徕戾⑸翳弪鲠蜷徕戾犷麒弪轭翳屮痱弩箝镱竣ㄦ轭洵殒犷麒弪＇鲠蜷徕戾┅ㄤ彐躅痱镳弪扉篝⑸痱镳弪铒瞽滹趑邃扉篝竣矧铛祆ㄡ钿ㄣ镱箴痱镳弪扉篝蝈篝┅┅ㄤ彐躅磲忮徜洵躅滹忾钿轭珞ㄣ镯痖戾洵屮痱弩箝镱螬⒄钿犷忾钿轭珞翳狒铄邃躅滹轭绠涉翳弪烈犷犰箫忾钿翳趄衢忮骘蝈麇篝狎舢ㄩ戾铉翳泔眇殪邃屮痱弩箝镱螬暴泔眇殪邃屮痱弩箝镱啜戾è镬洵趄衢ㄦ殪飙痫轭翦趄衢飒┅ㄦ轵篝泔眇殪邃屮痱弩箝镱螬括祜镳烘矧屮痱弩箝镱洪蝈篝泔眇殪邃屮痱弩箝镱螬恒镬戾泗Ж躅滹忾钿轭珞镬洵趄衢飑恒镬戾泗屮痱弩箝镱┅┅ㄤ彐躅忾钿躅怙躅洵鲠蝮疳蜥礤翦蝮屮痱⒙轭犷鲠蜷徕戾轭屮痱ㄢ弩殇弩翳疳蜥礤翦蝮麸铄鲠蝮戾è屮痱鲠蝮箦舡溟骀弪孱沐鲠蜷徕戾蟓轭屮痱疳蜥礤翦蝮┅ㄩ屮痱鲠蝮啜戾磲疸狎＇灬礅溽鲠颟啜鲠咯┅屮痱鲠蝮屮痱屮痱┅